---
title: "COVID-19 trends and trajectories"
author:
  - name: Tim Churches 
    affiliation: South Western Sydney Clinical School, UNSW Medicine & Ingham Institute of Applied Medical Research, Liverpool, Sydney, Australia
    affiliation_url: https://swscs.med.unsw.edu.au
  - name: Nick Tierney 
    affiliation: Monash University
    affiliation_url: 
date: 03-20-2020
output:
  html_document:
    toc: true
    toc_depth: 3
    self_contained: true
vignette: >
  %\VignetteIndexEntry{cumulative-cases}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = FALSE, 
                      cache = FALSE,
                      collapse = TRUE,
                      tidy.opts = list(width.cutoff = 60),
                      tidy = TRUE)
```

```{r libraries}
library(covidrecon)
library(dplyr)
library(ggplot2)
library(lubridate)
library(ggplot2)
library(ggrepel)
```

```{r get-latest-data}
covid <- covid_latest()
```

```{r}
covid %>% 
  filter(geo_id == "CN") %>% 
  ggplot(aes(x = date,
             y = cumulative_cases,
             group = country_region)) +
    geom_line() +
    scale_y_log10()
```


```{r high-incidence-countries}
high_incidence_countries <- covid_high_incidence(covid)

high_incidence_countries %>% 
  filter(geo_id == "CN") %>% 
  ggplot(aes(x = date_since_limit_cases,
             y = cumulative_cases,
             group = country_region)) +
    geom_line() +
    scale_y_log10()
```

```{r select-countries}
selected_countries <- c("China",
                        "Singapore",
                        "Japan",
                        "Iran",
                        "Italy",
                        "Spain",
                        "US",
                        "United_Kingdom",
                        "Australia",
                        "France",
                        "South_Korea")

```


```{r get-latest-data-highlight}
library(gghighlight)

gg_covid_cumulative_cases(high_incidence_countries)

covid %>% 
  filter(country_region %in% c("Australia", "Italy")) %>% 
  gg_covid_cumulative_cases() +
  geom_line(aes(colour = country_region))

# # sanity check the data
# cdc <- NCoVUtils::get_ecdc_cases()
# 
# cdc %>% 
#   arrange(country, date) %>% 
#   group_by(country) %>% 
#   mutate(cumulative_cases = cumsum(cases)) %>% 
#   ungroup() %>% 
#   # filter(country %in% c("Australia", "Italy")) %>% 
#   ggplot(aes(x = date,
#              y = cumulative_cases,
#              group = country)) + 
#   geom_line() +
#   scale_y_log10()
  
```

## The "Grattan Institute" cumulative incidence plot

https://blog.grattan.edu.au/2020/03/australian-governments-can-choose-to-slow-the-spread-of-coronavirus-but-they-must-act-immediately/

```{r}
high_incidence_countries %>% 
  filter(date_since_limit_cases >= 0 ) %>% 
  filter(country_region %in% selected_countries) %>% 
  gg_covid_cumulative_exceed_limit() + 
  labs(caption = 
  "CC BY-NC-SA Tim Churches (UNSW)
  Nick Tierney (Monash)
  Data source: European CDC"
    )


```

